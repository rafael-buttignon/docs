# Acessos e permissões

Para começar a trabalhar na Arquitetura 2.0, precisamos de acesso a algumas aplicações. A seguir, iremos discorrer abaixo todas essas ferramentas e como conseguir os acessos.

## Instalação do WSL

### Funcionários Folha Ambev

Para instalar o WLS no ambiente local, será necessária abrir uma Solicitação no Now .

1. Abrir chamado no Now - Ofertas Serviços de TI:

 <img src="https://i.imgur.com/PTGmI9o.png">



2. Abrir a Solicitação do Tipo Instalação de Software.

<img src="https://i.imgur.com/dgOOUmR.png">


3. Preencher a Descrição/ Justificativa com o seguinte texto:

"Olá,
Meu nome é:______ trabalho no time:______ da torre de:______ .

Gostaria de solicitar a execução da instalação do WSL2 versão 20.04 que é pré-requisito para uso do da plataforma de analytics IRIS.

Orientação e passos aqui: https://iris.ambev.com.br/pt-br/iris-ingestion/getting-started/setup#instala%C3%A7%C3%B5es

Obrigado"

> IMPORTANTE: É necessário que vocês adicionem o [**Anexo**](https://anheuserbuschinbev.sharepoint.com/sites/irisplatform/Documentos%20Compartilhados/Forms/AllItems.aspx?id=%2Fsites%2Firisplatform%2FDocumentos%20Compartilhados%2FMateriais%20Iris%2FV%C3%ADdeos%20Treinamentos%2FProduto%2FIngestion%2FTreinamento%20Degreed%2FOK%20Cassiano%20%2D%20Instala%C3%A7%C3%A3o%20WSL%2Epdf&parent=%2Fsites%2Firisplatform%2FDocumentos%20Compartilhados%2FMateriais%20Iris%2FV%C3%ADdeos%20Treinamentos%2FProduto%2FIngestion%2FTreinamento%20Degreed), onde consta o ok para aprovação da solicitação e também o [**Anexo**](https://anheuserbuschinbev.sharepoint.com/:w:/r/sites/irisplatform/_layouts/15/Doc.aspx?sourcedoc=%7B5392E52E-61A3-422A-B367-A2027ECF190C%7D&file=Instala%C3%A7%C3%A3o%20do%20WSL%202.docx&action=default&mobileredirect=true)onde consta o processo de instalação do WSL.
{.is-warning}



### Funcionários Folha AmbevTech

Para instalar o WLS no ambiente local, será necessária enviar um e-mail pedindo para que o Time de Suporte instale na máquina .

1. Enviar e-mail para: agiliza@ambevtech.com.br

2. Com o Seguinte texto:

"Olá,

Meu nome é:______ trabalho no time:____ da torre de:_____.

Gostaria de solicitar a execução da instalação do WSL2 versão 20.04 que é pré-requisito para uso do da plataforma de analytics IRIS.

Orientação e passos aqui: https://iris.ambev.com.br/pt-br/iris-ingestion/getting-started/setup#instala%C3%A7%C3%B5es

Obrigado"

<img src="https://i.imgur.com/4BFBi1n.jpg">


> IMPORTANTE: É necessário que vocês adicionem o [**Anexo**](https://anheuserbuschinbev.sharepoint.com/sites/irisplatform/Documentos%20Compartilhados/Forms/AllItems.aspx?id=%2Fsites%2Firisplatform%2FDocumentos%20Compartilhados%2FMateriais%20Iris%2FV%C3%ADdeos%20Treinamentos%2FProduto%2FIngestion%2FTreinamento%20Degreed%2FOK%20Cassiano%20%2D%20Instala%C3%A7%C3%A3o%20WSL%2Epdf&parent=%2Fsites%2Firisplatform%2FDocumentos%20Compartilhados%2FMateriais%20Iris%2FV%C3%ADdeos%20Treinamentos%2FProduto%2FIngestion%2FTreinamento%20Degreed), onde consta o ok para aprovação da solicitação e também o [**Anexo**](https://anheuserbuschinbev.sharepoint.com/:w:/r/sites/irisplatform/_layouts/15/Doc.aspx?sourcedoc=%7B5392E52E-61A3-422A-B367-A2027ECF190C%7D&file=Instala%C3%A7%C3%A3o%20do%20WSL%202.docx&action=default&mobileredirect=true)onde consta o processo de instalação do WSL.
{.is-warning}


## Github - Autenticação 2F

Antes de solicitar acesso ao Github é importante fazer a autenticação em dois fatores. O objetivo é aumentar a segurança de sistemas logáveis, que são acessadas por um usuário e uma senha. Para garantir a segurança dos nossos repositórios adicionamos uma outra etapa de verificação por uma segunda senha ou uma verificação no celular.

### Configurando

1- Para configurar esse sistema é necessário utilizar um app chamado Microsoft Authenticator, disponível para Android e para IOS, Faça download pelo seu celular.

![Imgur](https://i.imgur.com/ou1LdO0.png)

2- o segundo passo é acessar o seu perfil no github  


No seu perfil, na lateral superior direita, clicando no seu ícone você deve acessar a opção <kbd>settings</kbd>

![github](https://docs.github.com/assets/images/help/settings/userbar-account-settings.png)

3- na lateral esquerda no menu de navegação acesse <kbd>account security</kbd>

![github](https://docs.github.com/assets/images/help/settings/settings-sidebar-account-security.png)

4- Você visualizará uma opção para ativar a autenticação em duas etapas.

![github](https://docs.github.com/assets/images/help/2fa/enable-two-factor-authentication-dialoge.png)

5- há duas opções de configuração mas somente a opção utilizando o aplicativo é disponível no  Brasil, desta forma selecione a opção <kbd>Set up using an app</kbd> 

6 - Você receberá alguns códigos de recuperação que você deve **guardar em um lugar seguro** para caso seja necessário uma recuperação da sua conta sem acesso ao app, então escolha a melhor forma de armazenar esses códigos entre as opções disponíveis. Após salvar seus códigos de recuperação clique em <kbd>Next</kbd>

![github](https://docs.github.com/assets/images/help/2fa/download-print-or-copy-recovery-codes-before-continuing.png)

7- Será apresentado um QR Code que você deverá ler com o seu aplicativo inicialmente instalado. 
Acessando o aplicativo você visualizará a página abaixo e deve adicionar a conta do GitHub, selecionado o tipo como **outros** e fazendo a leitura do QR Code com o celular.

![Imgur](https://i.imgur.com/HlpFYAU.png)



![github](https://docs.github.com/assets/images/help/2fa/totp-enter-code.png)

*Obs: Caso não consiga ler o QR Code você pode utilizar o código mostrado na página do GitHub*


Uma vez configurando o aplicativo você deve digitar a senha mostrada no seu aplicativo. Essa senha é atualizada a cada 30 segundos então seja rápido! :running:

![Imgur](https://i.imgur.com/am6vf7M.png)

feito isso você configurou o seu acesso em duas etapas. :)


### Explorando outras opções de segurança

Você também pode utilizar uma chave fisica ou a sua impressão digital para acessar seu GitHub, nesta seção iremos mostrar como configurar a sua digital.

1- Essa opção de segurança só está disponível em alguns navegadores,como Chrome e o Firefox.
O primeiro passo é configurar o Windows Hello, digite na barra de pesquisa do Windows <kbd>Opções de Entrada</kbd>  e selecionar a opção Impressão digital do Windows Hello.

![Imgur](https://i.imgur.com/9IVhbCU.png)

![Imgur](https://i.imgur.com/Tn5HYE4.png)

![Imgur](https://i.imgur.com/yzdPAmp.png)

Nessa configuração ele solicitará que você também crie uma senha numérica PIN caso a opção de impressão digital não esteja disponível e também utilizará o app Microsoft Authenticator para gerenciar essa etapa de segurança. Perceba que nesse caso estamos evoluindo a segurança do seu computador! o que garante que não só seu repositório mas também seus arquivos estarão mais seguros agora. ;) 

2- Uma vez configurado o Windows Hello acesse o seu navegador e vá até sua página do GitHub pelo caminho Settings> Accout Security.

![github](https://docs.github.com/assets/images/help/settings/settings-sidebar-account-security.png)


e na sessão Two-factor authenticator selecione Segurity keys.

Você vai ser redirecionado a uma página com diversas possíveis configurações de segurança e iremos adicionar uma nova chave de segurança.

![Imgur](https://i.imgur.com/uAvQR09.png)

3- selecione adicionar e dê um nome amigável para sua chave. Ao selecionar adicionar escolha a opção de impressão digital e você terá cadastrado sua digital para acessar os seus repositórios. :beers:

### Erros comuns
#### Falha ao reconhecer as senhas do aplicativo
Um erro comum que pode ocorrer é uma falta de sincronia entre a Time Zone do GitHub e o celular. Desta forma o GitHub não reconhece a senha mostrada no aplicativo.

Solução 1 : Sincronizar a Data e Hora do seu celular
Busque por opções de Data e Hora e selecione as opções de Data e Hora automaticas e Fuso horário automático.

Solução 2 : Utilize o Google Authenticator :D

#### GitHub não reconhece credenciais 

Uma vez que você ativou o 2FA pode ser necessário reconfigurar as credenciais do seu ambiente de programação.

você  pode criar um Token Pessoal para validar suas credenciais quando estiver programando. <a href="https://docs.github.com/pt/github/authenticating-to-github/creating-a-personal-access-token" target="_blank">Consulte aqui a documentação para criação do Token.</a>





## Acesso: Github e Databricks


**Repositório**: [**Correnteza**](https://github.com/cervejaria-ambev/correnteza)

 - Para conseguir vizualizar os logs de execução, é necessário acesso ao [Workspace do Databricks de Ingestion](https://adb-6864341063350484.4.azuredatabricks.net/?o=6864341063350484#). 
 - Para conseguir fazer a exploração dos dados, é necessario acesso ao [Workspace do Databricks de Intelligence](https://adb-5055431857639398.18.azuredatabricks.net/?o=5055431857639398#).
 
Para conseguir acesso abra um chamado no [**Board de Operações**](https://dev.azure.com/AMBEV-SA/IRIS-AnalyticsPlatform/_boards/board/t/AnalyticsTeam/Customer%20Service?backlogLevel=Customer%20Service) do tipo **Acesso Arquitetura 2**.

``Exemplo:``
<img src="https://i.imgur.com/HTogulO.jpg">

## Airflow
- Para usuários ``@ambev``, o acesso ao Airflow é através do SSO, então basta usar seu login e senha do AD.
- Para usuários ``@ambevtech``, orientamos a utilizar o usuário de serviço da sua torre.

>**Roles Disponíveis**
**Viewer:** Todos têm acessos de viewer por padrão. Podem vizualizar as DAGs e logs de execução.
**Ops_Iris:** Apenas alguns usuários têm permissão. O acesso é liberado através de card no [**Board**](https://dev.azure.com/AMBEV-SA/IRIS-AnalyticsPlatform/_boards/board/t/AnalyticsTeam/Customer%20Service?backlogLevel=Customer%20Service). Podem criar conexões, pausar e disparar Dags.
{.is-info}


**Link**: [**Airflow**](https://airflow-iris.ambev.com.br/)

## Datadog


- Para usuários ``@ambev`` O acesso ao Airflow é através do SSO. Então basta usar seu login e senha do AD.
- Para usuários ``@ambevtech`` orientamos a utilizar o usuário de serviço da sua torre.

**Link**: [**Airflow DAGs**](https://ab-inbev.datadoghq.com/dashboard/3p7-p72-ydn/irisairflow-dags?tpl_var_context=%2A&tpl_var_env=aks-prod-iris&from_ts=1642600774536&to_ts=1642601674536&live=true)

---
## VPN Antiga

> **Atenção:**  Nós já solicitamos essa liberação para todos de Analytics, então o passo a seguir é somente se você ainda não tem essa liberação. Peço por favor que testem antes caso decida prosseguir com a solicitação..
 {.is-warning} 
 
### Funcionários Folha Ambev

1. Abrir chamado no Now

2. Do tipo Oferta: Solicitação de Acesso/Criação de grupo AD

3. Pedir para adicionar no grupo: "VPNPALOALTO_USERS"

"Olá,

Meu nome é:______ trabalho no time:____ da torre de:_____.
Usamos o WSL2 que é pré-requisito para uso do da plataforma de analytics IRIS. Porém, o NPA do Netskope é incompatível com o WSL2. Recebemos OK do Cassiano para reativação do Global Protect até o final do ano. A @Daniele.Bueno de Security está ciente e pode apoiar.

Obrigado"

### Funcionários Folha AmbevTech

1. Enviar e-mail para agiliza@ambevtech.com.br

2. Com o texto a seguir:

"Olá,

Meu nome é:______ trabalho no time:____ da torre de:_____.
Usamos o WSL2 que é pré-requisito para uso do da plataforma de analytics IRIS. Porém, o NPA do Netskope é incompatível com o WSL2. Recebemos OK do Celarino para reativação do Forticlient até o final do ano. A @Daniele.Bueno de Security está ciente e pode apoiar.

---

 Agora que você já possui os acessos necessários siga para a Instalação:
- [**Instalação**](/iris-ingestion/getting-started/setup)


# Instalação dos serviços


Para utilizar a plataforma em nossa nova arquitetura, são necessários alguns pré-requisitos, tanto de conhecimento, quanto de configuração de ambiente para desenvolvimento.
> É necessario que você já tenha todos os acessos liberados que foram citados na [**Página de Acesso**](/iris-ingestion/getting-started/access).
{.is-warning}

## Ferramentas de ambiente
Os serviços a serem instalados nas versões especificadas, e seguindo a ordem:
1. WSL-2
2. Visual Studio Code
3. GIT
4. Ubuntu 20.04
5. Python 3.8


> Utilizar versões diferentes das citadas acima, pode impedir o processo de ocorrer com sucesso
{.is-danger}

Para desenvolver utilizando o Windows, é necessário seguir as instruções a seguir. 
  
O repositório principal onde são centralizados os códigos é o [**Correnteza**](https://github.com/cervejaria-ambev/correnteza). O Correnteza é um repositório criado para alocar todas as DAGs que garantam **interoperabilidade**, **performance** e as melhores práticas de Engenharia e Arquitetura de Software de todos os pipelines de dados da companhia, utilizando os princípios do DDD e Data Mesh, conforme explicado na sessão de Arquitetura. 
  

Segue abaixo o passo a passo para instalar o ambiente na sua máquina, para que funcione tudo corretamente deve-se atentar aos detalhes.
  
<br> 
  
## **Instalação Git & VS Code**

Verifique se você já possui o **Git** e o **VS Code**, caso não tenha, faça o download, a instalação é padrão de como qualquer outro software.
  
  - 1 - **Download** [**Git**](https://git-scm.com/downloads/)
  - 2 - **Download** [**VS Code**](https://code.visualstudio.com/)
 
  
## **Instalação WSL-2(somente para terceiros)**

Você pode instalar tudo o que precisa para executar o Windows Subsystem for Linux (WSL) digitando este comando no modo administrador do PowerShell ou do prompt de comando do Windows e, em seguida, **reiniciando sua máquina.**
```sh
wsl --install -d Ubuntu-20.04 
  
```

**Reinicie sua máquina**, para não ter nenhum erro.  
  
Agora vamos Habilitar o Subsistema do Windows para Linux:


```sh
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
  
```
Habilitar o recurso de Máquina Virtual: 
```sh
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
  
```
Baixe o pacote de atualização do kernel do Linux, dependendo da sua versão do build do Windows, pode já estar atualizado, e irá exibir uma mensagem que já instalada a ultima versão.  

- [**Baixar Pacote de atualização do kernel do Linux do WSL2**](https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi)
  
Definir o WSL 2 como a sua versão padrão
```sh
wsl --set-default-version 2
  
```
  
**Reinicie sua máquina**, para não ter nenhum erro.
  
##  **Configurar seu nome de usuário e senha do Linux**  
 
Depois que o processo de **instalação** da distribuição do Linux com o WSL **for concluído**, abra a distribuição (Ubuntu por padrão) usando o menu Iniciar. Você será solicitado a criar um **Nome de Usuário** e uma **Senha** para sua distribuição do **Linux**.
  
- O Nome de **Usuário** e a **Senha** são específicos de cada distribuição do Linux separada que você instala e não têm nenhuma influência sobre o seu nome de usuário do Windows.
  
-  Depois de criar um Nome de **Usuário** e uma **Senha**, a conta será o usuário padrão para a distribuição e será conectada automaticamente ao iniciar.
  
- Essa conta será considerada o **administrador** do Linux, com a capacidade de executar comandos **administrativos** sudo (Super User Do).
  
- Cada distribuição do Linux em execução no WSL tem suas próprias **contas de usuário** e **senhas** do Linux. Você precisará configurar uma conta de usuário do Linux sempre que adicionar uma distribuição, **reinstalação** ou **redefinição**.

- Por padrão no sistema operacional Ubuntu, a senha não é exibida ao ser digitada. Por isso, armazene-a em algum lugar antes de preencher o campo.
  
>**Atenção:** Utilize um **Nome de Usuário** e **Senha** que você se **LEMBRE**, pois você precisara utilizar em breve. Na criação do seu **usuário** utilize apenas letras **minúsculas** é caracteres **não** especiais.
{.is-warning}
  
  
Agora vamos **verificar** se está tudo correto, primeiramente devemos ter certeza que essas 2 opções vão estar **ativas**.
  
Para verificar abra o menu iniciar e pesquise **Windows Feature**, e verifique se estão ativas as opções **Virtual Machine Platform** e **Windows Subsystem for Linux**.
  
![Imgur](https://i.postimg.cc/HnH4ZGWC/Windows-Feature.png)
  
Caso esteja **ativo**, podemos continuar a **instalação** com os próximos passos a passos, caso não esteja **ativo**, você pode clicar no checkbox e **ativar** as opções, ou rodar os **comandos** dos passos anteriores.
  
## **Configuração do WSL-2 (Ubuntu) Para utilizar os repositórios.**  
  
>**Importante:** Quando executar o comando `git clone` o git ira pedir suas **credenciais** de, **Usuário** e **Senha**. Mas como nossos repositórios são **privados**, e provavelmente sua conta possui **2FA**, você não ira conseguir apenas adicionar sua senha, será necessário gerar seu **PERSONAL ACCESS TOKEN**.
{.is-warning}

Vamos gerar o **Token**:
  
- **Verifique** seu nome de **usuário** no [**GitHub**](https://github.com/).
  ![Imgur](https://i.postimg.cc/1tbJ1RwN/nome-de-usu-rio.png)
  
- **Gere** o [**Personal Access Token  Nesse Link**](https://github.com/settings/tokens/new). Se ainda permaneça dúvidas veja esse [**Vídeo Tutorial**](https://www.youtube.com/watch?v=JR8zSoaHEvg&ab_channel=Principalengineer) 
  ![Imgur](https://i.postimg.cc/HW764510/personalacesstoken.png)


  
>**Nota:** Os **comandos** abaixo é para ser executado **dentro** do **Terminal do Ubuntu**! 
{.is-info}
  
**Pronto**, após ter pego seu **Usuário** e o **Personal Access Token**, execute o comando abaixo. Para baixar o repositório na sua máquina. Execute o **comando**:

```sh
git clone https://github.com/cervejaria-ambev/correnteza.git
```

Abra o repositório do **Correnteza** com o **VS Code**. Execute o comando do diretório do Correnteza, baixado:
  
- <kbd>cd correnteza</kbd> --> Vai **navegar**, até a pasta do repositório que é <kbd>correnteza</kbd>
- <kbd>code .</kbd> --> Ira **abrir** o código fonte que você ira trabalhar dentro do **Visual Studio Code**.
~~~sh
cd correnteza
code .
~~~
  
Para começar configurar o ambiente de desenvolvimento no **WSL-2** necessário fazer algumas configurações e rodar alguns comandos:
  
```sh
  sudo apt install make
  sudo apt-get install build-essential
```
  
Instalar o **Python 3** e configurar um ambiente de programação em um servidor Ubuntu, caso tenha dúvidas veja este [**Tutorial**](https://www.digitalocean.com/community/tutorials/how-to-install-python-3-and-set-up-a-programming-environment-on-an-ubuntu-20-04-server-pt).

```sh
	sudo apt update
  sudo apt -y upgrade
  sudo apt install -y python3-pip
  sudo apt install python3-venv
  sudo apt install -y build-essential libssl-dev libffi-dev python3-dev
  sudo apt-get update
```

Temos que fazer a **instalação** de algumas libs do JAVA.

```sh
sudo apt-get update
sudo apt-get install openjdk-11-jdk
```

Instalação da biblioteca **virtualenv** para ativar o ambiente virtual.

```sh
pip install virtualenv
```
  
Para configurar o ambiente de desenvolvimento local com **Python3**, **VirtualEnv** e as dependências de projeto, execute o comando a seguir:

```sh
make dev-setup
```

> **Atenção:** O comando make **dev-setup**, vai fazer toda a instalação de dependências do repositório do Correnteza. Bem provável que demore alguns minutos para completar o fim das instalações. Não saia do terminal e não feche o projeto, até que as instalações forem concluídas!
{.is-warning}


Você pode executar o comando abaixo para verificar todas as **tarefas disponíveis** que vão te apoiar no processo de **desenvolvimento**:

```sh
make help
```  
  
Ativar o **Ambiente Virtual** na sua máquina:

```sh
source .env/bin/activate
```
  
>**Nota:** Um ambiente virtual é um ambiente Python, de modo que o **interpretador**, as **bibliotecas** e os **scripts** Python **instalados**, nele são isolados daqueles instalados em outros ambientes virtuais e (por padrão) quaisquer bibliotecas instaladas em um Python do “sistema”, ou seja, instalado como parte do seu sistema operacional.  
{.is-info}

  
> **Atenção:** Sempre que começar o processo de **desenvolvimento** é importante ter certeza que seu ambiente virtual esteja **ativo**! Verifique se no terminal esta como **(.env)** caso não esteja é importante você entrar no ambiente virtual novamente a partir do comando: **source .env/bin/activate**
{.is-warning}

<br>
  
## **Configurar o VS Code para desenvolver dentro do WSL**  
 
Vamos **configurar** o Visual Studio Code com o Remote - WSL. O Visual Studio Code, juntamente com a extensão Remote-WSL, permite que você use o WSL como seu ambiente de **desenvolvimento** em tempo integral diretamente no VS Code. 

Ele permite que você:
  
-   desenvolva em um ambiente baseado em Linux.
-   use cadeias e utilitários específicos do Linux.
-   execute e depure seus aplicativos baseados em Linux do conforto de Windows enquanto mantém o acesso a ferramentas de produtividade como Outlook e Office.
-  use o VS Code terminal interno para executar sua distribuição do Linux de sua escolha.
-  aproveite os recursos de VS Code como a conclusão de código do Intellisense, a reutilização, suporte à depuração, os trechos de código e os testes de unidade.
-  gerencie facilmente seu controle de versão com o suporte interno a Git do VS Code
-  execute comandos e extensões de VS Code diretamente em seus projetos do WSL
-  edite arquivos em seu sistema de arquivos do Linux ou montado Windows (por exemplo/mnt/c) sem se preocupar com problemas de caminhos, compatibilidade binária ou outros desafios entre sistemas operacionais
  
<br>
  
Para **instalar** a extensão basta abrir o **VS Code** e ir em **extensões** no campo esquerdo inferior, como mostra a imagem abaixo. Após ir em extensões **procure** pela extensão **Remote - WSL** ou somente **WSL**, após achar a **extensão**, clique em **install**. 
  
![Imgur](https://i.postimg.cc/qR8wsmQ6/Installar.png)

>Após **re-abrir** o VS Code no **canto inferior esquerdo na barra de status**, você pode ver se sua instancia está **conectada** ao WSL: Ubuntu.  
{.is-info}
  
  
  
>**Nota:** Agora você ja possui o **ambiente configurado**, podendo utilizar a nossa plataform e até mesmo contribuir com ela. Caso ainda tenha **dúvida** de algum passo, leia novamente, caso a dúvida persista procure alguém do time da **Iris** para te ajudar!
{.is-info}

# Verificar se um dataset ou DAG já existe

Antes de criar uma DAG contendo a ingestão de um dataset, orientamos para que consulte se esta tabela já faz parte de um processo ativo. Esta consulta pode ser feita por meio do Metabase ou de uma DAG.

Caso uma DAG que supra o seu escopo já exista, mas ainda não contenha o seu dataset, você pode editar esta DAG, adicionando uma nova task. O fluxo abaixo representa este proceso:

<p align="center">
	<img width="80%" src="/iris-ingestion/dag_flow.png">
</p>

## O dataset que preciso já está sendo ingerido?

### Via Metabase
Você pode consultar se já existe um processo para este dataset com base na platforma [**Metabase**](https://metabase-iris.ambev.com.br/question#eyJkYXRhc2V0X3F1ZXJ5Ijp7ImRhdGFiYXNlIjozMCwidHlwZSI6InF1ZXJ5IiwicXVlcnkiOnsic291cmNlLXRhYmxlIjoyMjkwNH19LCJkaXNwbGF5IjoidGFibGUiLCJ2aXN1YWxpemF0aW9uX3NldHRpbmdzIjp7fX0=). Através dela, é possível consultar todos os dados e análises realizados pelos domínios da companhia.

![Plataforma Metabase](/iris-ingestion/metabase.png)
 
 <p></p>

### Via GitHub
Uma outra forma de encontrar o dataset é verificando diretamente para o repositório no GitHub: 
1. Abra o repositório [**clicando aqui**](https://github.com/cervejaria-ambev/quincy).

2. Na barra de pesquisa, busque pelo nome do dataset.

![Buscando pelo GitHub se o dataset existe](/iris-ingestion/busca_github_1.png)

3. Caso haja alguma tabela com aquele nome, é possível verificar nos resultados.

![Resultado se o dataset existe em alguma DAG](/iris-ingestion/busca_github_2.png)


## Já existe DAG pronta para este banco de dados?
 
Se ainda assim o dataset não estiver sendo ingerido, busque pelo repositório se existe alguma DAG dentro do seu escopo que possua utilize o mesmo conector pelo qual você irá precisar. Caso exista uma DAG com o mesmo conector e escopo do seu, crie uma **task** dentro dela.

## A frequência da DAG satisfaz minha necessidade?

Caso o schedule da DAG não supra a sua demanda, orientamos para que crie uma nova task na DAG, assim como no tópico anterior.


## Por fim, quando posso criar a DAG?
 
 A [**criação da DAG**](https://iris.ambev.com.br/pt-br/data-ingestion/arq2-0/how-to/ingest) deve ser considerada somente se:
 - Não existir nenhum processo para o dataset atual
 - Não existir nenhuma DAG dentro do seu escopo e que utilize o mesmo conector que você pretende utilizar
 - Possuir as credenciais de autenticação da origem

## Lembre-se de ter as credenciais da fonte de origem
Caso exista a necessidade de criar uma nova DAG, é preciso ter em mãos as credenciais de autenticação da fonte, seja ela usuário, senhas, tokens, etc.

### ABFS

Para credenciais de ABFS, é preciso obter chaves de uma das três formas de autenticação

#### Como conseguir as chaves de autenticação

Para acessarmos o blob a fim de ler seus arquivos é necessário autenticarmos o acesso, e para isso, dispinibilizamos três estratégias de autenticacão: access key, sas token e service principal.  Para saber mais sobre como funcionam os tipos de autenticacão é possîvel consultar a documentação da microsoft 

##### Access key

Para obter a chave de acesso de um blob navegue ate a conta de armazenamento do blob>chaves de acesso 

  <a href="https://imgur.com/GK53fCP"><img src="https://i.imgur.com/GK53fCP.png" title="source: imgur.com" width="400"/></a>

Escolha qual das duas chaves possíveis você deseja usar, clique em mostrar e copie sua chave 

 <a href="https://imgur.com/6Mp2swc"><img src="https://i.imgur.com/6Mp2swc.png" title="source: imgur.com" width="500"/></a>

##### SAS token

Para obter o token sas de um blob navegue até a conta de armazenamento do blob>assinatura de acesso compartilhado  

<a href="https://imgur.com/1MH4rvZ"><img src="https://i.imgur.com/1MH4rvZ.png" title="source: imgur.com" width="400"/></a>
 

Na opção “Tipos de recurso permitidos” selecione “Serviço”, “Contêiner” e “Objeto”; e na opção Permissões aceitas retire a seleção de “Excluir” e “Exclusão permanente”. 

Determine tambem uma data de inicio e fim para a validade daquele token. 

 <a href="https://imgur.com/H557YZ1"><img src="https://i.imgur.com/H557YZ1.png" title="source: imgur.com" /></a>

Em seguida, selecione a chave de acesso a partir da qual será gerado o token SAS e selecione “Gerar a cadeia de conexão e de SAS 
<a href="https://imgur.com/suyNAPR"><img src="https://i.imgur.com/suyNAPR.png" title="source: imgur.com" /></a>

O seu token SAS será gerado  
<a href="https://imgur.com/oeIGK7c"><img src="https://i.imgur.com/oeIGK7c.png" title="source: imgur.com" /></a>

##### Service principal
Para realização de autenticação com service principal é necessario que se crie um aplicativo (também chamado de cliente) que vai acessar o blob.

No portal azure procure por Azure Active Directory> registros de aplicativo> novo registro
<a href="https://imgur.com/Lsr1xjN"><img src="https://i.imgur.com/Lsr1xjN.png" title="source: imgur.com" /></a>

Nomeie seu aplicativo>Selecione um tipo de conta com suporte, que determina quem poderá usar o aplicativo.
Em URI de redirecionamento, selecione Web para o tipo de aplicativo que deseja criar. Insira o URI para o qual o token de acesso será enviado> Selecione Registrar

<a href="https://imgur.com/R0qIyRx"><img src="https://i.imgur.com/R0qIyRx.png" title="source: imgur.com" /></a>

Em seguida precisamos atribuir uma função ao aplicativo criado dentro do escopo que desejamos atribuir o aplicativo, no nosso caso, os blobs estao dentro das contas de armazenamento, entao precisamos adicionar uma nova atribuicao de funcao na conta de armazenamento que desejamos acessar. 

Abra a conta de armazenamento> vá em IAM > Adicionar atribuição de função

<a href="https://imgur.com/eM5f2sw"><img src="https://i.imgur.com/eM5f2sw.png" title="source: imgur.com" /></a>

No campo Função(Role) selecione "Colaborador de Dados do Storage Blob" e forneca o acesso para a opcao "Usuário, grupo ou entidade de serviço"

Por fim selecione seu app criado.

<a href="https://imgur.com/OHV1Pdc"><img src="https://i.imgur.com/OHV1Pdc.png" title="source: imgur.com" /></a>

Para nossa autenticação precisamos do application id (client id), tenant id e client secret. Para isso navegue novamente ate Azure Active Directory e encontre seu app criado em registros de aplicativo.
Em overview é possível encontrar o application id e o tenant id 

<a href="https://imgur.com/dpSxiTs"><img src="https://i.imgur.com/dpSxiTs.png" title="source: imgur.com" /></a>

Em seguida em "certificates and secrets" é possivel encontrar o client secret

<a href="https://imgur.com/ncg0Zxu"><img src="https://i.imgur.com/ncg0Zxu.png" title="source: imgur.com" /></a>